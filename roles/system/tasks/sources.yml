---

- include_vars: "sources.yml"

- name: remove default source file
  copy:
    dest: /etc/apt/sources.list
    content: ''
  become: yes
  become_user: root

- name: make source files readable
  file:
    path: /etc/apt/sources.list.d/
    mode: a+r
    recurse: yes
  become: yes
  become_user: root

- name: enable package sources
  apt_repository:
    repo: "deb {{item}}"
    update_cache: no
  become: yes
  become_user: root
  with_items: "{{ enabled_sources }}"

- name: disable package sources
  apt_repository:
    repo: "deb {{item}}"
    state: absent
    update_cache: no
  become: yes
  become_user: root
  with_items: "{{ disabled_sources }}"

- name: update sources
  apt:
    update_cache: yes
    upgrade: dist
    force: yes
  become: yes
  become_user: root

- name: autoremove sources
  apt:
    autoremove: yes
  become: yes
  become_user: root
